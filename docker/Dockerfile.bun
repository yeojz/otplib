ARG IMAGE_TAG=1.3.5-alpine
FROM oven/bun:${IMAGE_TAG}

# Install Node.js and pnpm for building packages
RUN apk add --no-cache nodejs npm
RUN npm install -g pnpm@8.14.0

WORKDIR /workspace

# Copy everything (including pre-built dist/)
COPY . .

# Install dependencies (for running tests)
RUN pnpm install --frozen-lockfile

# Default command (can be overridden)
CMD ["bun", "test", "packages/*/src/*.bun.test.ts"]
